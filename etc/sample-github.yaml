---

- core:
    listen: ["0.0.0.0", 8081]
    url: "http://eye.defiler.tk:8081"
    secrets: /etc/rci-secrets.yaml
    jobs-logs: /tmp/rci-logs
    logs-url: "https://seecloud.mirantis.com/rci/logs/"

- service:
    name: monitor
    module: rci.services.monitor
    http_path: monitor
    auth: github
    access:
      allow_anonymous: true
      admin:
        users: [redixin]
        orgs: []
      user:
        users: []
        orgs: [seecloud, r-ci]

- service:
    module: rci.services.github
    name: gh
    data-path: /tmp/rci-gh
    sessions-path: /tmp/rci-gh/sessions

- provider:
    name: os
    module: rci.providers.openstack
    max_vms: 64
    ssh:
      default_username: ubuntu
      key_name: rci
      private_key_path: /home/eye/.ssh/test
      jumphost:
        hostname: sc
        username: ubuntu
      access_net: "rci-int-net"
    clusters:
      single_ubuntu:
        ubuntu:
          image: "rci-u1404"
          flavor: rci-1vcpu-1024ram
          interfaces:
            - ["static", "rci-int-net"]

- script:
    name: env
    data: |
      env

- script:
    name: init
    data: |
      sudo apt-get -y update
      sudo apt-get -y install git

- script:
    name: git-checkout
    data: |
      env
      git help -g || sudo apt-get -y install git
      mkdir -p $GITHUB_REPO
      cd $GITHUB_REPO
      cd ..
      git clone git://github.com/$GITHUB_REPO.git || true
      cd ../$GITHUB_REPO
      git pull
      git checkout $GITHUB_HEAD

- job:
    name: env
    provider: os
    cluster: single_ubuntu
    scripts:
      ubuntu:
        - env
        - git-checkout

- matrix:
    name: image-builder
    projects:
      - r-ci/os-image-builder
      - r-ci/automation
      - redixin/automation
    cr:
      - env
    push:
      - env
